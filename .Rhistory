#   scale_y_continuous(labels = scales::percent_format()) +
#   labs(x = "seconds", y = "%")
# Calculate eCDF manually for each algorithm
ecdf_data <- report_last |>
filter(!is.na(time_visit)) |>
group_by(alg) |>
arrange(time_visit) |>
mutate(
ecdf_value = (row_number()) / n()
) |>
ungroup()
# Plot with geom_step
plot_surv_mode <- ggplot(ecdf_data, aes(x = time_visit, y = ecdf_value, color = algorithm)) +
geom_step(linewidth=1.6) +
scale_color_manual(values = alg_colors, name = "Algorithm") +
scale_y_continuous(labels = scales::percent_format()) +
labs(x = "seconds", y = "% of simulations")
return(plot_surv_mode)
}
violin_plot_last <- function(the_list,add_info,subset_ids,subset_rfs, return_dataset=F){
distances <- the_list[["distances"]]
distances$id <- as.numeric(str_extract(distances$alg, "\\(\\d+\\)") |>
str_remove_all("[()]"))
distances <- distances |> left_join(add_info,by="id")
#Subset the distances dataset only for the specified ids
if(!missing(subset_ids)){
distances <- distances |>
filter(id %in% subset_ids)
}
if(!missing(subset_rfs)){
#Subset the distances dataset only for the specified ids
distances <- distances |>
filter(rf %in% subset_rfs)
}
distances <- distances |> select(-id);
dist_t1 <- distances |> mutate(temperature=as.numeric(temperature)) |>
group_by(alg) |>
summarise(max_temp=max(temperature)) |>
right_join(distances,by="alg") |>
filter(temperature==max_temp) |>
select(-max_temp) |>
ungroup()
dist_t1_times <- dist_t1  |>
mutate(time_fixed=ifelse(min_dist>0,Inf,time_find)) |>
select(-min_dist,-time_find) |>
pivot_longer(cols=c(time_fixed),names_to="variable",values_to="measure") |>
pivot_wider(names_from=mode,values_from=measure) |>
rowwise() |>
mutate(first_time = min(across(matches("^m\\d+$"))),
last_time = max(across(matches("^m\\d+$"))))
dist_t1_times[dist_t1_times==Inf] <- NA ## replace Infinities for NAs
report_last <- dist_t1_times |>
select(alg,rf,last_time)|>
rename(time_visit=last_time)
#Modify names of algorithm
report_last$alg <- str_remove(report_last$alg,"\\([^)]*\\)$")
report_last <- report_last |> left_join(alg_names,by="alg") |> ungroup()
plot_surv_mode <- ggplot(report_last,aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm") +
labs(x = "Rejection Free replicas", y = "seconds")
ret_list=list();
if(return_dataset){
return(report_last)
}else{
return(plot_surv_mode)
}
}
export_plot <- function(the_plot,plot_name,h_l_dim,dimension){
if(h_l_dim !="lowdim" && h_l_dim != "highdim"){stop("Incorrect dimension. Should be lowdim or highdim")}
if(h_l_dim=="lowdim"){
if(missing(dimension)){
plot_name <- paste0(plot_name,"_ld.jpg")
file_name <- file.path(export_path_lowdim,plot_name)
}else{
plot_name <- paste0(plot_name,"_ld_",dimension,".jpg")
file_name <- file.path(export_path_lowdim,plot_name)
}
}
if(h_l_dim=="highdim"){
if(missing(dimension)){
plot_name <- paste0(plot_name,"_hd.jpg")
file_name <- file.path(export_path,plot_name)
}else{
plot_name <- paste0(plot_name,"_hd_",dimension,"k.jpg")
file_name <- file.path(export_path,plot_name)
}
}
jpeg(file_name,width=1200,height = 600,pointsize = 30)
print(the_plot)
dev.off()
message("Successfully created plot: ",plot_name)
}
# To create swap rate table in latex
create_swap_rate_table <- function(lll,h_l_dim,dimension){
if(h_l_dim !="lowdim" && h_l_dim != "highdim"){stop("Incorrect dimension. Should be lowdim or highdim")}
swap_rate <- lll$swap_rate
swap_rate$replica <- as.numeric(swap_rate$replica)
swap_rate <- fix_alg_name(swap_rate)
sr_report <- swap_rate |>
group_by(algorithm,replica) |>
summarise(avg.sr=mean(swap_rate,na.rm=T)) |> ungroup() |>
arrange(algorithm,replica)
#Horizontal
# horizontal_report_sr <- sr_report |>
#   pivot_wider(names_from = replica,values_from = avg.sr)
#Vertical
vertical_report_sr <- sr_report  |>
pivot_wider(names_from = algorithm,values_from = avg.sr)
# boxplot_sr <- swap_rate |>
#   ggplot(aes(x=factor(replica),y=swap_rate))+
#   geom_boxplot()+
#   geom_hline(yintercept=0.234,col="red")+
#   facet_wrap(~algorithm)
# table_sr_report <- horizontal_report_sr |>
#   mutate(across(-algorithm,round,digits=4))
table_sr_report <- vertical_report_sr |>
mutate(across(-replica,round,digits=4))
#Export table with averages
# stargazer(table_sr_report,
#           summary=F,
#           type="latex",
#           rownames=F,
#           title=paste0("Average swap rate between replica $\\beta_{i}$ and  $\\beta_{i+1}$"),
#           label=paste0("tab:swap_rate_",dimension,"k"),
#           out=file.path(tables_path,paste0("avg_swap_rate_dim",dimension,".tex")))
#Particular changes depending on model
table_file_name <- ""
table_caption <- ""
table <- label <- ""
if(h_l_dim=="lowdim"){
table_file_name <- paste0("avg_swap_rate_ld_", dimension, ".tex");
if(dimension=="7_mode"){dimension_patch <-"7 modes" }
if(dimension=="bimodal"){dimension_patch <-"bimodal" }
table_caption <- paste0("Average swap rate between replica $\\beta_{i}$ and $\\beta_{i+1}$ for the ",dimension_patch," model")
table_label <- paste0("tab:swap_rate_", dimension)
}
if(h_l_dim=="highdim"){
table_file_name <- paste0("avg_swap_rate_hd_dim", dimension, ".tex");
table_caption <- paste0("Average swap rate between replica $\\beta_{i}$ and $\\beta_{i+1}$ in space of dimension ",dimension,"000")
table_label <- paste0("tab:swap_rate_", dimension, "k")
}
#Export modifying the name of rows
# Generate stargazer output as a character vector
latex_code <- stargazer(table_sr_report,
summary = FALSE,
type = "latex",
rownames = FALSE,
title = table_caption,
label = table_label)
# Replace numbers in replica with beta and subindex
for (i in table_sr_report$replica) {
latex_code <- gsub(paste0("^", i, " &"),
paste0("$\\\\beta_{", i, "}$ &"),
latex_code)
}
# Write to file
writeLines(latex_code,
file.path(tables_path, table_file_name))
}
# To create latex table of average number of iterations per replica
create_table_iterations <- function(the_list,h_l_dim,dimension,subset_ids){
dataset <- the_list[["iterations"]]
dataset$id <- as.numeric(str_extract(dataset$alg, "\\(\\d+\\)") |>
str_remove_all("[()]")) #Create ID variable
dataset$replica <- as.numeric(dataset$replica)
dataset <- fix_alg_name(dataset)
if(!missing(subset_ids)){dataset <- dataset |> filter(id %in% subset_ids)}
summary_report <- dataset |>
group_by(algorithm,id,replica) |>
summarise(avg.iter=mean(iterations)) |>
ungroup()
summary_report <- summary_report |>
select(algorithm,replica,avg.iter) |>
pivot_wider(names_from=algorithm,values_from=avg.iter) |>
mutate(across(-replica, ~ round(.x, 3)))
#Particular changes depending on model
table_file_name <- ""
table_label <- ""
table_caption <- paste0("Average number of iterations between replica swaps")
if(h_l_dim=="lowdim"){
table_file_name <- paste0("avg_iter_ld_", dimension, ".tex");
table_label <-paste0("tab:avg_iter_", dimension)
}
if(h_l_dim=="highdim"){
table_file_name <- paste0("avg_iter_hd_dim", dimension, ".tex");
table_label <-paste0("tab:avg_iter_", dimension, "k")
}
#Export modifying the name of rows
# Generate stargazer output as a character vector
latex_code <- stargazer(summary_report,
summary = FALSE,
type = "latex",
rownames = FALSE,
title = table_caption,
label = table_label)
# Replace numbers in replica with beta and subindex
for (i in summary_report$replica) {
latex_code <- gsub(paste0("^", i, " &"),
paste0("$\\\\beta_{", i, "}$ &"),
latex_code)
}
# Write to file
writeLines(latex_code,
file.path(tables_path, table_file_name))
}
# To create latex table of the values of the betas used in the replicas
create_table_temperatures <- function(the_list,h_l_dim,dimension,subset_ids){
dataset <- the_list[["temperatures_matrix"]]
dataset <- fix_alg_name(dataset)
if(!missing(subset_ids)){dataset <- dataset |> filter(id %in% subset_ids)}
dataset <- unique(dataset)
table_temperatures <- dataset |>
select(algorithm,temperature,temp_id) |>
pivot_wider(names_from = algorithm,values_from=temperature)
#Particular changes depending on model
table_file_name <- ""
table_label <- ""
if(h_l_dim=="lowdim"){
table_file_name <- paste0("temperatures_ld_", dimension, ".tex");
table_label <-paste0("tab:temperatures_", dimension)
if(dimension=="7_mode"){dimension_patch <-"7 modes" }
if(dimension=="bimodal"){dimension_patch <-"bimodal" }
table_caption <- paste0("Inverse temperature used in the ",dimension_patch," model")
}
if(h_l_dim=="highdim"){
table_file_name <- paste0("temperatures_hd_dim", dimension, ".tex");
table_label <-paste0("tab:temperatures_", dimension, "k")
table_caption <- paste0("Inverse temperature used in the problem of dimension ",dimension,"k")
}
#Export modifying the name of rows
# Generate stargazer output as a character vector
latex_code <- stargazer(table_temperatures,
summary = FALSE,
type = "latex",
rownames = FALSE,
title = table_caption,
label = table_label)
# Replace numbers in replica with beta and subindex
for (i in table_temperatures$temp_id) {
latex_code <- gsub(paste0("^", i, " &"),
paste0("$\\\\beta_{", i, "}$ &"),
latex_code)
}
# Write to file
writeLines(latex_code,
file.path(tables_path, table_file_name))
}
### Specifically for lowdim
# To create plot of Total Variation Distance
plot_tvd <- function(the_list,filter_measurement=50,filter_time=1500, subset_ids){
tvd_report <- the_list[["tvd_report"]] #Extract tvd_report
tvd_report$id <- as.numeric(str_extract(tvd_report$alg, "\\(\\d+\\)") |>
str_remove_all("[()]")) #Create ID variable
tvd_report <- fix_alg_name(tvd_report)
tvd_summary <- tvd_report |>
group_by(id,algorithm,measurement) |>
summarise(avg_tvd=mean(tvd),avg_time=mean(time)) |>
ungroup()
if(!missing(subset_ids)){#If we want to subset IDs
tvd_summary <- tvd_summary |> filter(id %in% subset_ids)
}
tvd_plot <- tvd_summary |>
filter(measurement>filter_measurement) |>
filter(avg_time<filter_time) |>
ggplot(aes(x=avg_time,y=avg_tvd,color=algorithm))+
geom_line(linewidth=1.2, alpha=0.4)+
geom_point(aes(x=avg_time,y=avg_tvd),size=0.4,alpha=0.5)+
scale_color_manual(values = alg_colors, name = "Algorithm")+
labs(x = "seconds", y = "TVD")
return(tvd_plot)
}
# To create plot of speed to mode
speed_mode_lowdim <- function(the_list,subset_ids){
time_visit <- the_list[["time_visit"]]
time_visit$id <- as.numeric(str_extract(time_visit$alg, "\\(\\d+\\)") |>
str_remove_all("[()]"))
time_visit <- fix_alg_name(time_visit)
if(!missing(subset_ids)){
time_visit <- time_visit |> filter(id %in% subset_ids)
}
time_visit_report <- time_visit |>
pivot_wider(names_from=mode, values_from=time) |>
mutate(count_modes=rowSums(!is.na(across(starts_with("m"))))) |>
rowwise() |>
mutate(first_time = min(across(matches("^m\\d+$")),na.rm=T),
last_time = max(across(matches("^m\\d+$")),na.rm=T))
#Manually calculate ECDF
ecdf_data <- time_visit_report |>
select(algorithm,last_time) |>
group_by(algorithm) |>
arrange(last_time) |>
mutate(ecdf_value = (row_number()) / n()) |>
ungroup()
#Create plot
plot_speed_mode <- ggplot(ecdf_data, aes(x = last_time, y = ecdf_value, color = algorithm)) +
geom_step(linewidth=1.6) +
scale_color_manual(values = alg_colors, name = "Algorithm") +
scale_y_continuous(labels = scales::percent_format()) +
labs(x = "seconds", y = "% of simulations")
return(plot_speed_mode);
}
}
##### Other files and functions to modify the data #####
{
alg_correction <- tibble(alg=c("PT A-IIT(sq)","PT A-IIT(min)","PT_IIT_Z(sq)","PT_IIT_Z(min)","PT-IIT(sq)","PT-IIT(min)"),
algorithm=c("A-IIT","MH-mult","IIT","RF-MH","IIT","RF-MH"))
fix_alg_name <- function(dataframe_input){
dataframe_input <- dataframe_input |>
mutate(alg=str_remove(alg, "\\(\\d+\\)$")) |> #Modify name of algorithm, delete ID
left_join(alg_correction,by="alg") #Add the standardized name of the algorithm
return(dataframe_input)
}
}
##### Define the ids to use for the plots below
chosen_ids_1k <- c(1100:1103)
chosen_ids_3k <- c(1104:1107)
chosen_ids_5k <- c(1108:1111)
chosen_ids_7k <- c(1112:1115)
chosen_ids_bimodal <- c(600,702,663,703)
chosen_ids_7_mode <- c(612,700,614,701)
#####  Table: summary of iterations #####
{
# High dimension
chosen_dim <- "highdim"
for(i in 1:4){
lll <- create_plot_input(list_hd_names[i],mat_ids_hd[i,],chosen_dim)
create_table_iterations(lll,chosen_dim,dimension=dim_size[i])
}
###################################################################
# Low dimension
chosen_dim <- "lowdim"
for(i in 1:2){
lll <- create_plot_input(list_ld_names[i],mat_ids_ld[i,],chosen_dim)
create_table_iterations(lll,chosen_dim,dimension=model_name[i])
}
}
# High dimension
chosen_dim <- "highdim"
for(i in 1:4){
lll <- create_plot_input(list_hd_names[i],mat_ids_hd[i,],chosen_dim)
create_table_iterations(lll,chosen_dim,dimension=dim_size[i])
}
chosen_ids_1k <- c(1100:1103)
chosen_ids_3k <- c(1104:1107)
chosen_ids_5k <- c(1108:1111)
chosen_ids_7k <- c(1112:1115)
mat_ids_hd <- rbind(chosen_ids_1k,chosen_ids_3k,chosen_ids_5k,chosen_ids_7k)
mat_ids_hd_with_mult <-mat_ids_hd[,c(1,3)] #Ids ot algorithms that use multiplicity list
#used in Plots to compare algorithms that use Multiplicity list
list_hd_names <- c(paste0("dim_",seq(1,7,by=2),"k_100"))
dim_size <- c(1,3,5,7)
chosen_ids_bimodal <- c(600,702,663,703)
chosen_ids_7_mode <- c(612,700,614,701)
mat_ids_ld <- rbind(chosen_ids_bimodal,chosen_ids_7_mode)
list_ld_names <- c("bimodal_new","7_mode_new")
model_name <- c("bimodal","7_mode")
#####  Table: summary of iterations #####
{
# High dimension
chosen_dim <- "highdim"
for(i in 1:4){
lll <- create_plot_input(list_hd_names[i],mat_ids_hd[i,],chosen_dim)
create_table_iterations(lll,chosen_dim,dimension=dim_size[i])
}
###################################################################
# Low dimension
chosen_dim <- "lowdim"
for(i in 1:2){
lll <- create_plot_input(list_ld_names[i],mat_ids_ld[i,],chosen_dim)
create_table_iterations(lll,chosen_dim,dimension=model_name[i])
}
}
#File with info to join
add_info <- tibble(id=948:1007,
rf=rep(c(1:5,9:13),each=6),
dim=rep(c(3,3,5,5,7,7),10))
add_info <- rbind(add_info,
tibble(id=1012:1023,
rf=rep(c(6,7),each=6),
dim=rep(c(3,3,5,5,7,7),2))
)
### Create .Rds for the plots
#dim 3k, 1-7,9-13
chosen_ids <- c(seq(948,1007,by=6),
seq(949,1007,by=6),
seq(1012,1023,by=6),
seq(1013,1024,by=6))
lll <- create_plot_input("dim_3k_rf_alg",chosen_ids)
#dim 3k, 1-3
s_plot <- violin_plot_last(lll,add_info,subset_rfs=c(1:5))
s_plot
#dim 3k compare RF side by side
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ggplot(ddd,aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Rejection Free replicas", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
s_plot
#dim 3k compare RF for A-IIT
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="A-IIT") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Rejection Free replicas", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
s_plot
#dim 3k compare RF for A-IIT
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="MH-mult") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Rejection Free replicas", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
s_plot
#dim 3k compare RF for A-IIT
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="A-IIT") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using A-IIT", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
s_plot
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="A-IIT") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using A-IIT", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
export_plot(s_plot,"compare_RF_a_iit",dimension=3)
#dim 3k compare RF for A-IIT
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="A-IIT") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using A-IIT", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
export_plot(s_plot,"compare_RF_a_iit",dimension=3)
export_plot(s_plot,"compare_RF_a_iit","highdim",dimension=3)
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="A-IIT") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using A-IIT", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
export_plot(s_plot,"compare_RF_a_iit","highdim",dimension=3)
#dim 3k compare RF for A-IIT
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="MH-mult") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using A-IIT", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
export_plot(s_plot,"compare_RF_mh_mult","highdim",dimension=3)
#dim 3k compare RF for A-IIT
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="MH-mult") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using Metropolis-Hastings", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
export_plot(s_plot,"compare_RF_mh_mult","highdim",dimension=3)
#dim 3k compare RF for A-IIT
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="MH-mult") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using Metropolis-Hastings with a multiplicity list", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
export_plot(s_plot,"compare_RF_mh_mult","highdim",dimension=3)
s_plot
ddd <- violin_plot_last(lll,add_info,return_dataset = T,subset_ids=chosen_ids)
s_plot <- ddd |> filter(algorithm=="MH-mult") |>
ggplot(aes(x=factor(rf),fill=algorithm, y=time_visit))+
geom_violin()+
scale_fill_manual(values = alg_colors, name = "Algorithm")+
labs(x = "Number of replicas using MH with a multiplicity list", y = "seconds")+
facet_wrap(~algorithm)+
theme(legend.position = "none",
strip.text = element_text(size=25))
s_plot
export_plot(s_plot,"compare_RF_mh_mult","highdim",dimension=3)
